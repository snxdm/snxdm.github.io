<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image to GitHub</title>
</head>
<body>
    <h2>Upload Image to GitHub</h2>
    <form id="uploadForm">
        <input type="file" id="fileInput" accept="image/*" required>
        <button type="submit" id="uploadBtn">Upload Image</button>
    </form>
    <div id="output"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 阻止表单默认提交行为

            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0]; // 获取上传的文件
            if (!file) {
                alert('请选择要上传的图片文件！');
                return;
            }

            var formData = new FormData();
            formData.append('file', file); // 将文件添加到 FormData 对象中

            // 将文件内容转换为 Base64 编码
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                var content = reader.result.split(',')[1]; // 去掉 base64 头部信息

                // 使用 fetch 发起 POST 请求上传图片
                fetch('https://api.github.com/repos/snxdm/snxdm.github.io/contents/', {
                    method: 'POST',
                    headers: {
                        Authorization: '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',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Upload image',
                        content: content,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var imageUrl = data.content.download_url;
                    var output = document.getElementById('output');
                    output.innerHTML = '<img src="' + imageUrl + '" alt="Uploaded Image">';
                    output.innerHTML += '<p>Image uploaded successfully! <a href="' + imageUrl + '">View Image</a></p>';
                })
                .catch(error => {
                    console.error('Error uploading image:', error);
                    alert('上传图片时发生错误，请重试！');
                });
            };
        });
    </script>
</body>
</html>
